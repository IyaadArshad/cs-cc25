import { matchTasks } from "./matchTasks";
import OpenAI from "openai";

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

export async function POST(request: Request) {
  const { cookies } = await request.json();
  const {
    id,
    tasks,
  }: {
    id: { name: string; location: string; comingFrom: string };
    tasks: {
      visa: keyof typeof matchTasks.visa;
      school: keyof typeof matchTasks.school;
      dlicense: keyof typeof matchTasks.dlicense;
      insurance: keyof typeof matchTasks.insurance;
      sim: keyof typeof matchTasks.sim;
      bank: keyof typeof matchTasks.bank;
    };
  } = cookies;

  const taskDescriptions: Record<string, string> = {
    visa: matchTasks.visa[tasks.visa],
    school: matchTasks.school[tasks.school],
    dlicense: matchTasks.dlicense[tasks.dlicense],
    insurance: matchTasks.insurance[tasks.insurance],
    sim: matchTasks.sim[tasks.sim],
    bank: matchTasks.bank[tasks.bank],
  };

  const responseText = `The user's details:
    - Name: ${id.name}
    - Location: ${id.location}
    - Coming from ${id.comingFrom}
    The user has completed the following tasks:
    - Visa Status: ${taskDescriptions.visa}
    - School Setup: ${taskDescriptions.school}
    - Drivers license: ${taskDescriptions.dlicense}
    - Medical insurance: ${taskDescriptions.insurance}
    - SIM: ${taskDescriptions.sim}
    - Bank account: ${taskDescriptions.bank}`;

  const response = await openai.chat.completions.create({
    model: "gpt-4o-mini",
    messages: [
      {
        role: "system",
        content: [
          {
            text:
              `You are a friendly chat assistant to help new residents of the uae settle in. The user is currently in Abu Dhabi, make sure your responses are relevant to the user. ` +
              `\nThe user\'s details:\n- Name: ${id.name}\n- Location: ${id.location}\n- Coming from ${id.comingFrom}\n` +
              `The user has completed the following details:\n- Visa Status: ${taskDescriptions.visa}\n- School Setup: ${taskDescriptions.school} \n- Drivers license: ${taskDescriptions.dlicense}\n- Medical insurance: ${taskDescriptions.insurance}\n- SIM: ${taskDescriptions.sim} \n- Bank account: ${taskDescriptions.bank}\n` +
              'Make sure to use the above details as much as possible to tailor personalized messages.\nYou must know all of this about the user\n\n# Function Call Breakdown\n\n- **open_app_talabat**: To initiate food orders via Talabat.\n- **open_app_careem**: To book rides with Careem.\n- **open_app_zomato**: To initiate food orders via Zomato.\n- **open_app_entertainer**: To view available discounts using Entertainer.\n- **open_app_tripadvisor**: To explore travel destinations on Tripadvisor.\n- **open_app_visitabudhabi**: To view travel destinations in Abu Dhabi with Visit Abu Dhabi.\n- **open_app_adpolice**: To manage police-related services such as traffic fines with Abu Dhabi Police.\n- **open_app_darb**: To access toll gate information or top up accounts on DARB.\n- **open_discover_page**: To navigate to a page for discovering places.\n- **open_apps**: To access a list of available applications.\n- **open_home**: To return to the app\'s homepage.\n\nNote that you aren\'t directly opening these apps, by calling these functions, button(s) will appear below your message allowing the user to select an action\n\n# Steps\n\n1. **Analyze the Request**: Understand the primary intention behind the user\'s request.\n2. **Determine Necessary Function Calls**: Identify which app functions, if any, align with the request.\n3. **Generate Response**: Craft a response incorporating relevant information or actions based on the user\'s request.\n4. **Format the Output**: Ensure the response and function calls are properly formatted.\n\n# Output Format\n\nThe output should be formatted as a JSON object containing:\n- `"response"`: A string with the model\'s response.\n- `"function_calls"`: An array listing the necessary function calls relevant to the user\'s request.\n\n# Primary Knowledge\nYour knowledge should mainly use this for knowledge about abu dhabi:\nexport const placesToVisit = [\n  {\n    image: "/img/discover/placesToVisit/sheikhZayedGrandMosque.png",\n    title: "Sheikh Zayed Grand Mosque",\n    description:\n      "Iconic mosque known for its stunning white domes and intricate Islamic architecture.",\n    longDescription: [\n      "The Sheikh Zayed Grand Mosque stands as one of the world\'s largest mosques and an architectural masterpiece that intentionally blends different Islamic architectural schools.",\n      "The mosque features 82 domes, more than 1,000 columns, 24-carat gold-plated chandeliers, and the world\'s largest hand-knotted carpet. Its main prayer hall can accommodate over 7,000 worshippers.",\n      "White marble panels ornamented with semi-precious stones, including lapis lazuli, red agate, amethyst, abalone shell and mother of pearl, create intricate floral designs throughout the mosque.",\n    ],\n    externalLink: "https://www.szgmc.gov.ae/en",\n  },\n  {\n    image: "/img/discover/placesToVisit/louvre.png",\n    title: "Louvre Abu Dhabi",\n    description:\n      "World-class museum showcasing art and artifacts from around the globe.",\n    longDescription: [\n      "The Louvre Abu Dhabi represents a unique cultural collaboration between Abu Dhabi and France, bringing the renowned Louvre name to the UAE.",\n      "The museum\'s striking architecture, designed by Jean Nouvel, features a vast silver dome that appears to float above the water, creating an enchanting \'rain of light\' effect inspired by the emirate\'s palm trees.",\n      "Housing over 600 artworks, including both permanent collections and loans from French partner museums, the Louvre Abu Dhabi tells the story of humanity through art, from ancient times to the contemporary era.",\n    ],\n    externalLink: "https://www.louvreabudhabi.ae",\n  },\n  {\n    image: "/img/discover/placesToVisit/QasrAlWatan.png",\n    title: "Qasr Al Watan",\n    description:\n      "Presidential palace offering insights into UAE\'s culture and governance.",\n    longDescription: [\n      "Qasr Al Watan, the Presidential Palace of the UAE, opened its doors to the public in 2019 as a cultural landmark and architectural marvel.",\n      "The palace showcases traditional Arabian architecture and craftsmanship, featuring stunning white domes, intricate geometric patterns, and gardens inspired by Islamic design.",\n      "Visitors can explore the House of Knowledge, which contains rare manuscripts and books, and learn about the UAE\'s system of governance and traditions through interactive exhibitions.",\n    ],\n    externalLink: "https://www.qasralwatan.ae",\n  },\n  {\n    image: "/img/discover/placesToVisit/yas.png",\n    title: "Yas Island",\n    description:\n      "Entertainment hub featuring Ferrari World, Yas Waterworld, and Warner Bros. World.",\n    longDescription: [\n      "Yas Island is Abu Dhabi\'s premier entertainment destination, spanning 25 square kilometers of pure excitement and adventure.",\n      "Home to Ferrari World Abu Dhabi, the world\'s first Ferrari-branded theme park, featuring Formula Rossa, the world\'s fastest roller coaster, reaching speeds of up to 240 km/h.",\n      "The island also hosts Yas Waterworld, Warner Bros. World Abu Dhabi, and the Yas Marina Circuit, home to the Formula 1 Abu Dhabi Grand Prix.",\n      "With world-class hotels, shopping at Yas Mall, and a vibrant dining scene, Yas Island offers endless entertainment options for visitors of all ages.",\n    ],\n    externalLink: "https://www.yasisland.ae",\n  },\n  {\n    image: "/img/discover/placesToVisit/cornicheBeach.png",\n    title: "Corniche Beach",\n    description:\n      "Beautiful waterfront promenade perfect for relaxation and outdoor activities.",\n    longDescription: [\n      "The Corniche Beach is Abu Dhabi\'s premier public beach, stretching over 8 kilometers of pristine coastline.",\n      "This Blue Flag certified beach offers pristine white sand and crystal-clear waters, with dedicated swimming zones and lifeguards on duty throughout the day.",\n      "The promenade features cycling and walking paths, children\'s play areas, and numerous cafes and restaurants, making it a perfect destination for families and fitness enthusiasts alike.",\n      "Regular events and festivals are held along the Corniche, bringing the community together for celebrations and entertainment throughout the year.",\n    ],\n    externalLink: "https://visitabudhabi.ae/en/where-to-go/corniche-beach",\n  },\n  {\n    image: "/img/discover/placesToVisit/EmiratesPalace.png",\n    title: "Emirates Palace",\n    description:\n      "Luxurious hotel known for its opulent architecture and gold leaf interiors.",\n    longDescription: [\n      "The Emirates Palace is a landmark super-luxury hotel that has become synonymous with Arabian luxury and hospitality.",\n      "Built at a cost of $3 billion, the hotel features 394 rooms and suites, 114 domes, and over 1,000 chandeliers, with extensive use of gold leaf and marble throughout.",\n      "The palace grounds span 85 hectares, including pristine beaches, pools, and manicured gardens, offering guests an exclusive retreat in the heart of Abu Dhabi.",\n      "Famous for its Palace Cappuccino sprinkled with 24-karat gold flakes, the hotel offers unique dining experiences across its multiple award-winning restaurants.",\n    ],\n    externalLink: "https://www.mandarinoriental.com/abu-dhabi/emirates-palace",\n  },\n  {\n    image: "/img/discover/placesToVisit/mangroveNationalPark.png",\n    title: "Mangrove National Park",\n    description:\n      "Natural reserve offering kayaking tours through lush mangrove forests.",\n    longDescription: [\n      "The Mangrove National Park represents about 75% of the total mangrove forest area in the UAE, playing a crucial role in Abu Dhabi\'s ecosystem.",\n      "This protected area spans 19 square kilometers and is home to diverse wildlife, including herons, flamingos, and various marine life species.",\n      "Visitors can explore the mangroves through guided kayaking tours, paddleboarding sessions, or walking along the newly opened boardwalk.",\n      "The park serves as both a natural habitat and a research center, helping scientists study and preserve this unique ecosystem.",\n    ],\n    externalLink:\n      "https://visitabudhabi.ae/en/where-to-go/mangrove-national-park",\n  },\n];\n\nexport const foodPlaces = [\n  {\n    image: "/img/discover/culinaryDelights/shawarmaStation.png",\n    title: "Shawarma Station",\n    description:\n      "Popular chain known for fresh shawarmas and Middle Eastern street food.",\n    longDescription: [\n      "A beloved quick-service restaurant chain that\'s become synonymous with quality shawarmas in Abu Dhabi.",\n      "Known for their signature chicken and meat shawarmas, fresh juices, and falafel sandwiches.",\n      "Offers great value meals perfect for lunch breaks or quick dinners.",\n      "Multiple convenient locations across the city with consistent quality and fast service.",\n    ],\n    externalLink: "https://visitabudhabi.ae/restaurants/shawarmatime",\n  },\n  {\n    // Nested folder image: updated with a new valid URL\n    image:\n      "https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Flame-grilled_PERi-PERi_chicken.jpg/440px-Flame-grilled_PERi-PERi_chicken.jpg",\n    title: "Nando\'s",\n    description:\n      "Famous for its Peri-Peri chicken in a casual dining atmosphere.",\n    longDescription: [\n      "Nando\'s offers their world-famous flame-grilled Peri-Peri chicken at reasonable prices.",\n      "Wide range of spice levels from mild to extra hot, catering to all taste preferences.",\n      "Popular for both dine-in and takeaway, with numerous branches across Abu Dhabi.",\n      "Great value meal deals and family platters make it perfect for group dining.",\n    ],\n    externalLink: "https://www.nandos.ae",\n  },\n  {\n    image: "/img/discover/culinaryDelights/shakespeareAndCo.png",\n    title: "Shakespeare & Co.",\n    description:\n      "Casual dining café with international menu and charming atmosphere.",\n    longDescription: [\n      "Shakespeare & Co. offers a diverse menu of international dishes in a Victorian-inspired setting.",\n      "Known for their all-day breakfast, fresh pastries, and extensive beverage menu.",\n      "Comfortable seating and reasonable prices make it perfect for casual meals or coffee meetings.",\n      "Popular among families and professionals, with multiple locations across Abu Dhabi.",\n    ],\n    externalLink: "https://shakespeare-and-co.com",\n  },\n  {\n    image: "/img/discover/culinaryDelights/alMandi.png",\n    title: "Al Mandi and Al Madhbi House",\n    description:\n      "Authentic Yemeni restaurant specializing in Mandi and Madhbi dishes.",\n    longDescription: [\n      "Al Mandi and Al Madhbi House offers traditional Yemeni cuisine, known for its flavorful rice and grilled meats.",\n      "Signature dishes include slow-cooked Mandi, charcoal-grilled Madhbi, and rich, aromatic stews.",\n      "A cozy and welcoming atmosphere, perfect for families and groups.",\n      "Popular for both dine-in and takeaway, with generous portions at affordable prices.",\n    ],\n    externalLink: "https://almandi-house.ae/",\n  },\n  {\n    image: "/img/discover/culinaryDelights/lebaneseFlower.png",\n    title: "Lebanese Flower",\n    description: "Famous local spot for Lebanese cuisine at reasonable prices.",\n    longDescription: [\n      "Lebanese Flower is an Abu Dhabi institution, serving delicious Middle Eastern cuisine since 1991.",\n      "Known for their incredible shawarmas, mixed grills, and freshly baked Lebanese bread.",\n      "With multiple locations across the city, it\'s a go-to spot for both quick bites and family meals.",\n      "Their generous portions and consistent quality have made them a local favorite for decades.",\n    ],\n    externalLink: "https://lebaneseflower.ae",\n  },\n  {\n    image: "/img/discover/culinaryDelights/subway.png",\n    title: "Subway",\n    description: "Fresh sandwiches and salads with customizable options.",\n    longDescription: [\n      "Subway offers fresh, made-to-order sandwiches with a variety of healthy options.",\n      "Customize your meal with a wide selection of fresh vegetables and sauces.",\n      "Great value meal deals and regular promotions make it budget-friendly.",\n      "Perfect for quick lunches or light dinners, with locations throughout Abu Dhabi.",\n    ],\n    externalLink: "https://subway.com/en-AE",\n  },\n  {\n    image: "/img/discover/culinaryDelights/alMzrab.png",\n    title: "Al Mrzab",\n    description: "Authentic Emirati cuisine in a modern casual setting.",\n    longDescription: [\n      "Al Mrzab offers traditional Emirati dishes in a contemporary atmosphere.",\n      "Perfect introduction to local cuisine with friendly staff and English menus.",\n      "Reasonable prices and generous portions make it popular with tourists and locals alike.",\n      "Great place to try authentic Emirati dishes like Harees and Machboos.",\n    ],\n    externalLink: "https://visitabudhabi.ae/restaurants/al-mrzab",\n  },\n];\n\nexport const shoppingPlaces = [\n  {\n    image: "/img/discover/localMarketsAndStores/theGalleria.png",\n    title: "Yas Mall",\n    description:\n      "Largest mall in Abu Dhabi with over 370 stores and 60 restaurants.",\n    longDescription: [\n      "Yas Mall is Abu Dhabi\'s largest and most modern shopping destination, spanning over 2.5 million square feet.",\n      "The mall features unique concepts like Ferrari World Abu Dhabi and Warner Bros. World Abu Dhabi nearby.",\n      "Visitors can enjoy a diverse mix of international and local brands across fashion, electronics, and home furnishings.",\n      "The mall\'s entertainment options include a 20-screen cinema, family entertainment center, and year-round events.",\n    ],\n    externalLink: "https://yasmall.ae",\n  },\n  {\n    image: "/img/discover/localMarketsAndStores/theGalleria.png",\n    title: "The Galleria Al Maryah Island",\n    description:\n      "Luxury shopping destination with high-end brands and dining options.",\n    longDescription: [\n      "The Galleria is Abu Dhabi\'s premier luxury shopping and dining destination on Al Maryah Island.",\n      "The mall houses over 400 stores including flagship luxury boutiques and first-to-Abu Dhabi brands.",\n      "Its dining collection features award-winning restaurants with spectacular waterfront views.",\n      "The expansion includes a dedicated family entertainment zone with innovative leisure attractions.",\n    ],\n    externalLink: "https://thegalleria.ae",\n  },\n  {\n    image: "/img/discover/localMarketsAndStores/AbuDhabiMall.png",\n    title: "Abu Dhabi Mall",\n    description: "Central mall with a mix of local and international brands.",\n    longDescription: [\n      "Abu Dhabi Mall is strategically located in the heart of the city\'s business district.",\n      "The mall offers a comprehensive retail mix with over 200 stores spread across four levels.",\n      "Its family entertainment center and ice rink make it a popular destination for families.",\n      "The mall is directly connected to Beach Rotana Hotel, making it convenient for tourists.",\n    ],\n    externalLink: "https://abudhabi-mall.com",\n  },\n  {\n    image: "/img/discover/localMarketsAndStores/madinatZayed.png",\n    title: "Madinat Zayed Shopping Centre",\n    description: "Known for its gold souk and traditional items.",\n    longDescription: [\n      "Madinat Zayed Shopping Centre is famous for its extensive gold souk featuring dozens of jewelry stores.",\n      "The center offers traditional Arabic perfumes, textiles, and handicrafts alongside modern retail stores.",\n      "Its gold souk is known for competitive prices and authentic Arabic jewelry designs.",\n      "The shopping centre serves as a cultural bridge between traditional and modern retail experiences.",\n    ],\n    externalLink: "https://madinatzayed-mall.com",\n  },\n  {\n    image: "/img/discover/localMarketsAndStores/dalmaMall.png",\n    title: "World Trade Center Mall",\n    description:\n      "Modern mall in the heart of the city with a traditional souk feel.",\n    longDescription: [\n      "World Trade Center Mall combines modern retail with traditional Arabian architecture.",\n      "The mall features a contemporary interpretation of a traditional souk with over 160 shops.",\n      "Its central location makes it a key shopping destination in Abu Dhabi\'s downtown area.",\n      "The mall\'s rooftop garden provides a unique outdoor shopping and dining experience.",\n    ],\n    externalLink: "https://wtcad.ae",\n  },\n  {\n    image: "/img/discover/localMarketsAndStores/dalmaMall.png",\n    title: "Dalma Mall",\n    description:\n      "Large shopping center with a variety of stores and entertainment options.",\n    longDescription: [\n      "Dalma Mall is one of Abu Dhabi\'s largest shopping destinations with over 450 stores.",\n      "The mall features an extensive entertainment zone with a multi-screen cinema and family attractions.",\n      "Its diverse dining options include both international restaurants and local cuisine.",\n      "The mall serves as a community hub for the Mussafah and Mohammed Bin Zayed City areas.",\n    ],\n    externalLink: "https://dalmamall.ae",\n  },\n  {\n    image: "/img/discover/localMarketsAndStores/MushrifMall.png",\n    title: "Mushrif Mall",\n    description:\n      "Family-friendly mall with a good mix of retail and leisure facilities.",\n    longDescription: [\n      "Mushrif Mall is designed as a family-centric shopping destination with over 200 retail outlets.",\n      "The mall\'s distinctive feature is its circular design making navigation intuitive for shoppers.",\n      "It houses one of the largest indoor play areas for children in Abu Dhabi.",\n      "The mall\'s traditional souk section offers local products and handicrafts.",\n    ],\n    externalLink: "https://mushrifmall.com",\n  },\n];\n\nexport const essentialServices = [\n  {\n    image: "/img/discover/essentialServices/abuDhabiDepartmentOfMunicipalitiesAndTransport.png",\n    title: "TAMM Service Centre",\n    description: "One-stop shop for government services in Abu Dhabi.",\n    longDescription: [\n      "TAMM is Abu Dhabi\'s comprehensive government services platform integrating over 600 services.",\n      "The center offers digital solutions for business, personal, and administrative requirements.",\n      "TAMM\'s service centers provide in-person support with multilingual staff members.",\n      "The platform has revolutionized government service delivery in Abu Dhabi through digital transformation.",\n    ],\n    externalLink: "https://tamm.abudhabi",\n  },\n  {\n    image: "/img/discover/essentialServices/abuDhabiDepartmentOfMunicipalitiesAndTransport.png",\n    title: "Abu Dhabi Health Services (SEHA)",\n    description: "Network of public hospitals and clinics in Abu Dhabi.",\n    longDescription: [\n      "SEHA operates the largest healthcare network in the UAE with multiple hospitals and clinics.",\n      "The organization provides comprehensive healthcare services from primary to specialized care.",\n      "SEHA facilities are equipped with state-of-the-art medical technology and expert healthcare professionals.",\n      "Their services include emergency care, specialized treatments, and preventive healthcare programs.",\n    ],\n    externalLink: "https://seha.ae",\n  },\n  {\n    image: "/img/discover/essentialServices/abuDhabiChamber.png",\n    title: "Abu Dhabi Police",\n    description:\n      "Main law enforcement agency, offering various services including traffic-related matters.",\n    longDescription: [\n      "Abu Dhabi Police is the primary law enforcement agency ensuring safety and security in the emirate.",\n      "They offer digital services for traffic fines, licensing, and various security permits.",\n      "The force is known for its smart police stations providing 24/7 services without human intervention.",\n      "Their community policing initiatives help maintain strong relationships with residents.",\n    ],\n    externalLink: "https://adi.gov.ae",\n  },\n  {\n    image: "/img/discover/essentialServices/abuDhabiDepartmentOfMunicipalitiesAndTransport.png",\n    title: "Department of Municipalities and Transport",\n    description:\n      "Handles city planning, transportation, and municipal affairs.",\n    longDescription: [\n      "The Department oversees urban planning, infrastructure development, and public transportation in Abu Dhabi.",\n      "They manage municipal services including building permits and land allocation.",\n      "The department is responsible for developing and maintaining Abu Dhabi\'s transport network.",\n      "Their services include parking management, public bus operations, and maritime transport regulation.",\n    ],\n    externalLink: "https://dmt.gov.ae",\n  },\n  {\n    image: "/img/discover/essentialServices/abuDhabiDepartmentOfMunicipalitiesAndTransport.png",\n    title: "Abu Dhabi Distribution Company",\n    description: "Manages electricity and water services for residents.",\n    longDescription: [\n      "ADDC is the sole provider of electricity and water services in Abu Dhabi region.",\n      "They offer digital services for bill payments, connection requests, and consumption monitoring.",\n      "The company implements smart meter solutions for better resource management.",\n      "ADDC promotes sustainable consumption through various awareness programs.",\n    ],\n    externalLink: "https://addc.ae",\n  },\n  {\n    image: "/img/discover/essentialServices/abuDhabiChamber.png",\n    title: "Abu Dhabi Chamber",\n    description:\n      "Supports businesses and provides various commercial services.",\n    longDescription: [\n      "Abu Dhabi Chamber represents the interests of the private sector in Abu Dhabi.",\n      "They provide crucial services for business setup and development in the emirate.",\n      "The chamber offers training programs and workshops for business development.",\n      "Their services include certificate of origin issuance and business networking opportunities.",\n    ],\n    externalLink: "https://abudhabichamber.ae",\n  },\n  {\n    image: "/img/discover/essentialServices/abuDhabiJudicialDepartment.png",\n    title: "Abu Dhabi Judicial Department",\n    description: "Handles legal matters and court services in the emirate.",\n    longDescription: [\n      "The Judicial Department manages all courts and legal services in Abu Dhabi.",\n      "They provide digital services for case filing, document authentication, and legal inquiries.",\n      "The department offers alternative dispute resolution services including mediation.",\n      "Their services include notary public, marriage services, and legal consultation.",\n    ],\n    externalLink: "https://adjd.gov.ae",\n  },\n];\n\n# Notes\n\n- Prioritize clarity in responses; ensure function calls clearly match the user\'s request.\n- If no function call is needed, the `"function_calls"` array should be empty (`[]`).\n- Be attentive to requests involving multiple actions, ensuring each required function is called.\n- Review and update responses to reflect the most recent data and app capabilities.\n- Make sure your responses are personalized and only speak about topics that help the user settle in to the  uae and perform daily tasks and services',
            type: "text",
          },
        ],
      },
    ],
    response_format: {
      type: "json_schema",
      json_schema: {
        name: "api_response",
        schema: {
          type: "object",
          required: ["response", "function_calls"],
          properties: {
            response: {
              type: "string",
              description: "Your response",
            },
            function_calls: {
              type: "array",
              items: {
                enum: [
                  "open_app_talabat",
                  "open_app_careem",
                  "open_app_zomato",
                  "open_app_entertainer",
                  "open_app_tripadvisor",
                  "open_app_visitabudhabi",
                  "open_app_adpolice",
                  "open_app_darb",
                  "open_discover_page",
                  "open_apps",
                  "open_home",
                ],
                type: "string",
              },
              description: "A list of functions that you may want to call",
            },
          },
          additionalProperties: false,
        },
        strict: true,
      },
    },
    temperature: 1,
    max_completion_tokens: 13000,
    top_p: 1,
    frequency_penalty: 0,
    presence_penalty: 0,
  });

  return new Response(responseText, {
    status: 200,
    headers: {
      "Content-Type": "text/plain",
    },
  });
}